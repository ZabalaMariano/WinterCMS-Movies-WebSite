title = "Filter movies"
url = "/ajax-filter"
layout = "default"
is_hidden = 0

==
<?
    use MyPlugin\Movies\Models\Movie;
    use MyPlugin\Movies\Models\Genre;

    function onStart() { $this->prepareVars(); }
    
    function onFilterMovies() { $this->prepareVars(); }

    function prepareVars() {
        $options = post('Filter', []);

        $this['movies'] = Movie::listFrontEnd($options);
        $this['genres'] = Genre::all();

        $years = Movie::select('year')->groupBy('year')->orderBy('year')->pluck('year');
        $this['years'] = $years;
    }

?>
==
<h2 style="margin-top:40px;">Filtrar Pel√≠culas</h2>
    
<div class="row">
    <div class="col-4">
        {{ form_ajax('onFilterMovies', { update: { 'movies/movies': '#partialMovies' } }) }}
            <div id="MoviesFilter" class="movies-filter form">
                    
                <div class="form-group">
                    <label>Genres</label>
                    {% for genre in genres %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="Filter[genres][]" value="{{ genre.id }}" />    
                            <label>{{genre.genre_title}}</label>
                        </div>
                    {% endfor %}
                </div>

                <div class="form-group">
                    <label>Year</label>
                    <select class="form-control" name="Filter[year]">
                        <option value="">Select Year</option>
                        {% for year in years|sort %}
                            <option value="{{year}}">{{ year }}</option>
                        {% endfor %}
                    </select>
                </div>

            </div>
        {{ form_close() }}
    </div>

    <div class="col-8">
        <div id="partialMovies">
            {% partial 'movies/movies' %}
        </div>
    </div>
</div>